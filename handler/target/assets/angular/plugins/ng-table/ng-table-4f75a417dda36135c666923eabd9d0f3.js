/*
 New BSD License <http://creativecommons.org/licenses/BSD/>
 New BSD License <http://creativecommons.org/licenses/BSD/>
 New BSD License <http://creativecommons.org/licenses/BSD/>
 New BSD License <http://creativecommons.org/licenses/BSD/>
 New BSD License <http://creativecommons.org/licenses/BSD/>
*/
(function(c,q){if("function"===typeof define&&define.amd)define(["angular"],function(a){return q(a)});else return q(c)})(window.angular||null,function(c){var q=c.module("ngTable",[]);q.value("ngTableDefaults",{params:{},settings:{}});q.factory("NgTableParams",["$q","$log","ngTableDefaults",function(a,k,p){var f=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};return function(l,g){var b=this,s=function(){e.debugMode&&k.debug&&k.debug.apply(this,arguments)};this.data=[];this.parameters=function(d,
m){m=m||!1;if(c.isDefined(d)){for(var a in d){var h=d[a];if(m&&0<=a.indexOf("[")){for(var e=a.split(/\[(.*)\]/).reverse(),b="",g=0,l=e.length;g<l;g++){var k=e[g];if(""!==k){var p=h,h={};h[b=k]=f(p)?parseFloat(p):p}}"sorting"===b&&(n[b]={});n[b]=c.extend(n[b]||{},h[b])}else n[a]=f(d[a])?parseFloat(d[a]):d[a]}s("ngTable: set parameters",n);return this}return n};this.settings=function(d){return c.isDefined(d)?(c.isArray(d.data)&&(d.total=d.data.length),e=c.extend(e,d),s("ngTable: set settings",e),this):
e};this.page=function(d){return c.isDefined(d)?this.parameters({page:d}):n.page};this.total=function(d){return c.isDefined(d)?this.settings({total:d}):e.total};this.count=function(d){return c.isDefined(d)?this.parameters({count:d,page:1}):n.count};this.filter=function(d){return c.isDefined(d)?this.parameters({filter:d,page:1}):n.filter};this.sorting=function(d){if(2==arguments.length){var a={};a[d]=arguments[1];this.parameters({sorting:a});return this}return c.isDefined(d)?this.parameters({sorting:d}):
n.sorting};this.isSortBy=function(d,a){return c.isDefined(n.sorting[d])&&c.equals(n.sorting[d],a)};this.orderBy=function(){var d=[],a;for(a in n.sorting)d.push(("asc"===n.sorting[a]?"+":"-")+a);return d};this.getData=function(a,m){c.isArray(this.data)&&c.isObject(m)?a.resolve(this.data.slice((m.page()-1)*m.count(),m.page()*m.count())):a.resolve([]);return a.promise};this.getGroups=function(d,m){var r=a.defer();r.promise.then(function(a){var r={};c.forEach(a,function(a){var d=c.isFunction(m)?m(a):
a[m];r[d]=r[d]||{data:[]};r[d].value=d;r[d].data.push(a)});a=[];for(var b in r)a.push(r[b]);s("ngTable: refresh groups",a);d.resolve(a)});return this.getData(r,b)};this.generatePagesArray=function(a,m,c){var h,b,e;e=[];b=Math.ceil(m/c);if(1<b){e.push({type:"prev",number:Math.max(1,a-1),active:1<a});e.push({type:"first",number:1,active:1<a,current:1===a});h=Math.round(3);c=Math.max(2,a-h);m=Math.min(b-1,a+2*h-(a-c));for(h=c=Math.max(2,c-(2*h-(m-c)));h<=m;)h===c&&2!==h||h===m&&h!==b-1?e.push({type:"more",
active:!1}):e.push({type:"page",number:h,active:a!==h,current:a===h}),h++;e.push({type:"last",number:b,active:a!==b,current:a===b});e.push({type:"next",number:Math.min(b,a+1),active:a<b})}return e};this.url=function(a){var m=(a=a||!1)?[]:{},b;for(b in n)if(n.hasOwnProperty(b)){var h=n[b],e=encodeURIComponent(b);if("object"===typeof h)for(var f in h){if(!c.isUndefined(h[f])&&""!==h[f]){var g=e+"["+encodeURIComponent(f)+"]";a?m.push(g+"="+h[f]):m[g]=h[f]}}else c.isFunction(h)||c.isUndefined(h)||""===
h||(a?m.push(e+"="+encodeURIComponent(h)):m[e]=encodeURIComponent(h))}return m};this.reload=function(){var c=a.defer(),b=this,f=null;if(e.$scope)return e.$loading=!0,f=e.groupBy?e.getGroups(c,e.groupBy,this):e.getData(c,this),s("ngTable: reload data"),f||(f=c.promise),f.then(function(a){e.$loading=!1;s("ngTable: current scope",e.$scope);e.groupBy?(b.data=a,e.$scope&&(e.$scope.$groups=a)):(b.data=a,e.$scope&&(e.$scope.$data=a));e.$scope&&(e.$scope.pages=b.generatePagesArray(b.page(),b.total(),b.count()));
e.$scope.$emit("ngTableAfterReloadData");return a})};this.reloadPages=function(){e.$scope.pages=this.generatePagesArray(this.page(),this.total(),this.count())};var n=this.$params={page:1,count:1,filter:{},sorting:{},group:{},groupBy:null};c.extend(n,p.params);var e={$scope:null,$loading:!1,data:null,total:0,defaultSort:"desc",filterDelay:750,counts:[10,25,50,100],sortingIndicator:"span",getGroups:this.getGroups,getData:this.getData};c.extend(e,p.settings);this.settings(g);this.parameters(l,!0);return this}}]);
q.factory("ngTableParams",["NgTableParams",function(a){return a}]);q.controller("ngTableController",["$scope","NgTableParams","$timeout","$parse","$compile","$attrs","$element","ngTableColumn",function(a,k,p,f,l,g,b,s){function n(){a.params.$params.page=1}var e=!0;a.$filterRow={};a.$loading=!1;a.hasOwnProperty("params")||(a.params=new k,a.params.isNullInstance=!0);a.params.settings().$scope=a;var d=function(){var a=0;return function(c,b){p.cancel(a);a=p(c,b)}}();a.$watch("params.$params",function(b,
f){if(b!==f){a.params.settings().$scope=a;if(c.equals(b.filter,f.filter))a.params.reload();else{var h=e?c.noop:n;d(function(){h();a.params.reload()},a.params.settings().filterDelay)}a.params.isNullInstance||(e=!1)}},!0);this.compileDirectiveTemplates=function(){if(!b.hasClass("ng-table")){a.templates={header:g.templateHeader?g.templateHeader:"ng-table/header.html",pagination:g.templatePagination?g.templatePagination:"ng-table/pager.html"};b.addClass("ng-table");var d=null;0===b.find("> thead").length&&
(d=c.element(document.createElement("thead")).attr("ng-include","templates.header"),b.prepend(d));var f=c.element(document.createElement("div")).attr({"ng-table-pagination":"params","template-url":"templates.pagination"});b.after(f);d&&l(d)(a);l(f)(a)}};this.loadFilterData=function(b){c.forEach(b,function(b){var d;if(d=b.filterData(a,{$column:b}))return c.isObject(d)&&c.isObject(d.promise)?(delete b.filterData,d.promise.then(function(a){c.isArray(a)||c.isFunction(a)||c.isObject(a)?c.isArray(a)&&a.unshift({title:"-",
id:""}):a=[];b.data=a})):b.data=d;delete b.filterData})};this.buildColumns=function(b){return b.map(function(b){return s.buildColumn(b,a)})};this.setupBindingsToInternalScope=function(b){var d=f(b);a.$watch(d,function(b){c.isUndefined(b)||(a.paramsModel=d,a.params=b)},!1);g.showFilter&&a.$parent.$watch(g.showFilter,function(b){a.show_filter=b});g.disableFilter&&a.$parent.$watch(g.disableFilter,function(b){a.$filterRow.disabled=b})};a.sortBy=function(b,c){var d=b.sortable&&b.sortable();if(d){var f=
a.params.settings().defaultSort,e="asc"===f?"desc":"asc",g=a.params.sorting()&&a.params.sorting()[d]&&a.params.sorting()[d]===f,l=c.ctrlKey||c.metaKey?a.params.sorting():{};l[d]=g?e:f;a.params.parameters({sorting:l})}}}]);q.factory("ngTableColumn",[function(){var a={"class":function(){return""},filter:function(){return!1},filterData:c.noop,headerTemplateURL:function(){return!1},headerTitle:function(){return""},sortable:function(){return!1},show:function(){return!0},title:function(){return""},titleAlt:function(){return""}};
return{buildColumn:function(k,p){var f=Object.create(k),l;for(l in a)void 0===f[l]&&(f[l]=a[l]),c.isFunction(f[l])||function(a){f[a]=function(){return k[a]}}(l),function(a){var b=f[a];f[a]=function(){return 0===arguments.length?b.call(k,p):b.apply(k,arguments)}}(l);return f}}}]);q.directive("ngTable",["$q","$parse",function(a,k){return{restrict:"A",priority:1001,scope:!0,controller:"ngTableController",compile:function(a){var f=[],l=0,g=null;c.forEach(c.element(a.find("tr")),function(a){a=c.element(a);
a.hasClass("ng-table-group")||g||(g=a)});if(g)return c.forEach(g.find("td"),function(a){var g=c.element(a);if(!g.attr("ignore-cell")||"true"!==g.attr("ignore-cell")){var n=function(a){return g.attr("x-data-"+a)||g.attr("data-"+a)||g.attr(a)};a=function(a){var b=n(a);return b?function(a,d){return k(b)(a,c.extend(d||{},{$columns:f}))}:void 0};var e=n("title-alt")||n("title");e&&g.attr("data-title-text","{{"+e+"}}");f.push({id:l++,title:a("title"),titleAlt:a("title-alt"),headerTitle:a("header-title"),
sortable:a("sortable"),"class":a("header-class"),filter:a("filter"),headerTemplateURL:a("header"),filterData:a("filter-data"),show:g.attr("ng-show")?function(a){return k(g.attr("ng-show"))(a)}:void 0})}}),function(a,c,g,e){a.$columns=f=e.buildColumns(f);e.setupBindingsToInternalScope(g.ngTable);e.loadFilterData(f);e.compileDirectiveTemplates()}}}}]);q.directive("ngTableDynamic",["$parse",function(a){return{restrict:"A",priority:1001,scope:!0,controller:"ngTableController",compile:function(k){var p;
c.forEach(c.element(k.find("tr")),function(a){a=c.element(a);a.hasClass("ng-table-group")||p||(p=a)});if(p)return c.forEach(p.find("td"),function(a){a=c.element(a);a.attr("x-data-title")||a.attr("data-title")||a.attr("title")||a.attr("data-title-text","{{$columns[$index].titleAlt(this) || $columns[$index].title(this)}}");a.attr("ng-show")||a.attr("ng-show","$columns[$index].show(this)")}),function(c,l,g,b){l=g.ngTableDynamic;if(!l||-1<l.indexOf(" with "))g=l.split(/\s+with\s+/),l=g[0],g=g[1];else throw Error("Parse error (expected example: ng-table-dynamic='tableParams with cols')");
g=a(g)(c)||[];c.$columns=b.buildColumns(g);b.setupBindingsToInternalScope(l);b.loadFilterData(c.$columns);b.compileDirectiveTemplates()}}}}]);q.directive("ngTablePagination",["$compile",function(a){return{restrict:"A",scope:{params:"=ngTablePagination",templateUrl:"="},replace:!1,link:function(k,p,f){k.params.settings().$scope.$on("ngTableAfterReloadData",function(){k.pages=k.params.generatePagesArray(k.params.page(),k.params.total(),k.params.count())},!0);k.$watch("templateUrl",function(f){c.isUndefined(f)||
(f=c.element(document.createElement("div")),f.attr({"ng-include":"templateUrl"}),p.append(f),a(f)(k))})}}}]);c.module("ngTable").run(["$templateCache",function(a){a.put("ng-table/filters/select-multiple.html",'<select ng-options="data.id as data.title for data in $column.data" ng-disabled="$filterRow.disabled" multiple ng-multiple="true" ng-model="params.filter()[name]" ng-show="filter==\'select-multiple\'" class="filter filter-select-multiple form-control" name="{{name}}"> </select>');a.put("ng-table/filters/select.html",
'<select ng-options="data.id as data.title for data in $column.data" ng-disabled="$filterRow.disabled" ng-model="params.filter()[name]" ng-show="filter==\'select\'" class="filter filter-select form-control" name="{{name}}"> </select>');a.put("ng-table/filters/text.html",'<input type="text" name="{{name}}" ng-disabled="$filterRow.disabled" ng-model="params.filter()[name]" ng-if="filter==\'text\'" class="input-filter form-control"/>');a.put("ng-table/header.html",'<tr> <th title="{{$column.headerTitle(this)}}" ng-repeat="$column in $columns" ng-class="{ \'sortable\': $column.sortable(this), \'sort-asc\': params.sorting()[$column.sortable(this)]==\'asc\', \'sort-desc\': params.sorting()[$column.sortable(this)]==\'desc\' }" ng-click="sortBy($column, $event)" ng-show="$column.show(this)" ng-init="template=$column.headerTemplateURL(this)" class="header {{$column.class(this)}}"> <div ng-if="!template" ng-show="!template" class="ng-table-header" ng-class="{\'sort-indicator\': params.settings().sortingIndicator==\'div\'}"> <span ng-bind="$column.title(this)" ng-class="{\'sort-indicator\': params.settings().sortingIndicator==\'span\'}"></span> </div> <div ng-if="template" ng-show="template" ng-include="template"></div> </th> </tr> <tr ng-show="show_filter" class="ng-table-filters"> <th data-title-text="{{$column.titleAlt(this) || $column.title(this)}}" ng-repeat="$column in $columns" ng-show="$column.show(this)" class="filter"> <div ng-repeat="(name, filter) in $column.filter(this)"> <div ng-if="filter.indexOf(\'/\') !==-1" ng-include="filter"></div> <div ng-if="filter.indexOf(\'/\')===-1" ng-include="\'ng-table/filters/\' + filter + \'.html\'"></div> </div> </th> </tr> ');
a.put("ng-table/pager.html",'<div class="ng-cloak ng-table-pager" ng-if="params.data.length"> <div ng-if="params.settings().counts.length" class="ng-table-counts btn-group pull-right"> <button ng-repeat="count in params.settings().counts" type="button" ng-class="{\'active\':params.count()==count}" ng-click="params.count(count)" class="btn btn-default"> <span ng-bind="count"></span> </button> </div> <ul class="pagination ng-table-pagination"> <li ng-class="{\'disabled\': !page.active && !page.current, \'active\': page.current}" ng-repeat="page in pages" ng-switch="page.type"> <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">&laquo;</a> <a ng-switch-when="first" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="page" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="more" ng-click="params.page(page.number)" href="">&#8230;</a> <a ng-switch-when="last" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="next" ng-click="params.page(page.number)" href="">&raquo;</a> </li> </ul> </div> ')}]);
return q});