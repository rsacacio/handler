define(["../core","../var/support","../ajax"],function(e,f){e.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var k=0,h={},l={0:200,1223:204},c=e.ajaxSettings.xhr();window.attachEvent&&window.attachEvent("onunload",function(){for(var a in h)h[a]()});f.cors=!!c&&"withCredentials"in c;f.ajax=c=!!c;e.ajaxTransport(function(a){var d;if(f.cors||c&&!a.crossDomain)return{send:function(c,e){var g,b=a.xhr(),f=++k;b.open(a.type,a.url,a.async,a.username,a.password);if(a.xhrFields)for(g in a.xhrFields)b[g]=
a.xhrFields[g];a.mimeType&&b.overrideMimeType&&b.overrideMimeType(a.mimeType);a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(g in c)b.setRequestHeader(g,c[g]);d=function(a){return function(){d&&(delete h[f],d=b.onload=b.onerror=null,"abort"===a?b.abort():"error"===a?e(b.status,b.statusText):e(l[b.status]||b.status,b.statusText,"string"===typeof b.responseText?{text:b.responseText}:void 0,b.getAllResponseHeaders()))}};b.onload=d();b.onerror=d("error");d=h[f]=d("abort");
try{b.send(a.hasContent&&a.data||null)}catch(m){if(d)throw m;}},abort:function(){d&&d()}}})});